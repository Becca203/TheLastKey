# üéÆ Gu√≠a de Configuraci√≥n - Sistema Multijugador LAN 2D

## üìã Paso 1: Preparar Scripts

### Reemplazar scripts existentes:
1. **UDPServer.cs** - Reemplaza con la versi√≥n actualizada
2. **UDPClient.cs** - Reemplaza con la versi√≥n actualizada

### A√±adir nuevos scripts:
3. **GameManager.cs** - Gestor principal del juego
4. **NetworkPlayer.cs** - Sincronizaci√≥n de jugadores
5. **GameSaveSystem.cs** - Sistema de guardado JSON
6. **GameUIController.cs** - Interfaz de guardado/cargado

---

## üéØ Paso 2: Configurar la Escena del Juego (GameScene)

### A. Crear GameObject: "GameManager"
```
1. Crear Empty GameObject llamado "GameManager"
2. A√±adir script: GameManager.cs
3. Configurar en el Inspector:
   - Player1 Prefab: [Tu prefab del jugador 1]
   - Player2 Prefab: [Tu prefab del jugador 2]
```

### B. Crear Spawn Points
```
1. Crear Empty GameObject: "Player1SpawnPoint"
   - Position: (-2, 0, 0) o donde quieras que aparezca Player1
   
2. Crear Empty GameObject: "Player2SpawnPoint"
   - Position: (2, 0, 0) o donde quieras que aparezca Player2
```

### C. Asignar Spawn Points al GameManager
```
En el Inspector del GameManager:
- Player1 Spawn Point: [Arrastra Player1SpawnPoint aqu√≠]
- Player2 Spawn Point: [Arrastra Player2SpawnPoint aqu√≠]
```

---

## üé® Paso 3: Preparar los Prefabs de Jugadores

### Configuraci√≥n de cada Prefab:

**Componentes necesarios:**
- `Transform` (posici√≥n, rotaci√≥n, escala)
- `Rigidbody2D` (f√≠sica)
- `Collider2D` (colisiones)
- `SpriteRenderer` (gr√°fico)
- `PlayerMovement2D` (tu script existente)
- Un objeto hijo con Transform para `groundCheck`

**IMPORTANTE:** 
- Los prefabs NO deben tener el componente `NetworkPlayer` a√±adido manualmente
- El GameManager lo a√±adir√° autom√°ticamente al instanciarlos
- Aseg√∫rate de que el prefab tiene configurado el groundCheck correctamente

**Diferencia visual entre jugadores:**
- Player1: Sprite azul/verde
- Player2: Sprite rojo/naranja
- O usa sprites diferentes para cada uno

---

## üñ•Ô∏è Paso 4: Configurar UI (Opcional pero recomendado)

### Crear Canvas con UI de control:

```
Canvas (Screen Space - Overlay)
‚îú‚îÄ‚îÄ Panel "SaveLoadPanel"
‚îÇ   ‚îú‚îÄ‚îÄ Button "SaveButton" 
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Text: "Guardar (F5)"
‚îÇ   ‚îú‚îÄ‚îÄ Button "LoadButton"
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Text: "Cargar (F9)"
‚îÇ   ‚îú‚îÄ‚îÄ Text "StatusText"
‚îÇ   ‚îî‚îÄ‚îÄ Text "PlayerInfoText"
‚îî‚îÄ‚îÄ Script: GameUIController.cs
```

**Configurar GameUIController:**
- Save Button: [Arrastra el bot√≥n SaveButton]
- Load Button: [Arrastra el bot√≥n LoadButton]
- Status Text: [Arrastra StatusText]
- Player Info Text: [Arrastra PlayerInfoText]

---

## üöÄ Paso 5: Testing - C√≥mo Probar

### Setup de Testing:

**Build 1 (SERVER):**
```
1. File ‚Üí Build Settings
2. A√±ade todas las escenas:
   - ClientManager (scene inicial)
   - WaitingRoom
   - GameScene
3. Build en carpeta "Build_Server"
```

**Build 2 (CLIENT):**
```
1. Igual que Build 1
2. Build en carpeta "Build_Client"
```

### Proceso de Testing:

**1. Iniciar Servidor:**
```
- Ejecuta Build_Server
- En ClientManager:
  * IP: 127.0.0.1
  * Username: Player1
  * Click "Play"
```

**2. Iniciar Cliente:**
```
- Ejecuta Build_Client
- En ClientManager:
  * IP: 127.0.0.1
  * Username: Player2
  * Click "Play"
```

**3. Verificar en GameScene:**
```
‚úÖ Ambos jugadores deber√≠an aparecer en la escena
‚úÖ Player1 controla su personaje con A/D/Space
‚úÖ Player2 controla su personaje con A/D/Space
‚úÖ Cada jugador ve al otro moverse en tiempo real
```

---

## üéÆ Controles y Testing

### Controles del Juego:
- **A** - Mover izquierda
- **D** - Mover derecha
- **Space** - Saltar

### Teclas de Debug:
- **F5** - Guardar posici√≥n de jugadores
- **F9** - Cargar posici√≥n guardada

---

## ‚öôÔ∏è Configuraci√≥n Avanzada

### Ajustar velocidad de sincronizaci√≥n:

En `NetworkPlayer.cs`:
```csharp
[SerializeField] private float sendRate = 20f; // 20 veces/seg
[SerializeField] private float interpolationSpeed = 10f; // Suavidad
```

**Recomendaciones:**
- **sendRate**: 15-30 (m√°s = m√°s lag, pero m√°s preciso)
- **interpolationSpeed**: 8-15 (m√°s = menos suave pero m√°s reactivo)

### Auto-guardado:

En `GameSaveSystem.cs`:
```csharp
public bool enableAutoSave = true; // Activar auto-guardado
public float autoSaveInterval = 30f; // Guardar cada 30 segundos
```

---

## üêõ Soluci√≥n de Problemas Comunes

### ‚ùå "No se ve el otro jugador"
**Soluci√≥n:**
- Verifica que ambos clientes se conectaron (mira logs)
- Comprueba que los prefabs est√°n asignados en GameManager
- Aseg√∫rate que los Spawn Points existen en GameScene

### ‚ùå "El jugador remoto se mueve con lag"
**Soluci√≥n:**
- Aumenta `interpolationSpeed` en NetworkPlayer
- Reduce `sendRate` si la red est√° saturada

### ‚ùå "Los dos jugadores controlan el mismo personaje"
**Soluci√≥n:**
- Verifica que GameManager.localPlayerID est√° configurado correctamente
- Comprueba los logs para ver qu√© Player ID se asign√≥

### ‚ùå "Error al guardar JSON"
**Soluci√≥n:**
- Aseg√∫rate que GameSaveSystem est√° en la escena
- Verifica que los NetworkPlayer tienen Rigidbody2D

---

## üìä Logs Importantes

**Logs correctos al conectar:**
```
User joined: Player1 as Player 1
User joined: Player2 as Player 2
Starting game...
Sent GAME_START to Player1 with ID 1
Sent GAME_START to Player2 with ID 2
```

**Logs correctos en GameScene:**
```
Local Player ID set to: 1
Players initialized. Local: Player1
Local player configured: Player1
Remote player configured: Player2
```

---

## üéØ Checklist Final

Antes de hacer la Build final, verifica:

- [ ] Todos los scripts est√°n actualizados
- [ ] GameManager configurado con prefabs y spawn points
- [ ] Los prefabs tienen PlayerMovement2D y Rigidbody2D
- [ ] Los prefabs NO tienen NetworkPlayer (se a√±ade autom√°ticamente)
- [ ] GameScene est√° en Build Settings
- [ ] Se distinguen visualmente Player1 y Player2
- [ ] UI de guardado est√° configurada (opcional)
- [ ] Probado en Unity Editor antes de hacer Build

---

## üìù Notas Adicionales

### Formato de archivo JSON guardado:
```json
{
  "players": [
    {
      "playerID": 1,
      "posX": -2.5,
      "posY": 1.2,
      "velX": 0.0,
      "velY": 0.0
    },
    {
      "playerID": 2,
      "posX": 3.1,
      "posY": 0.5,
      "velX": 1.5,
      "velY": -0.2
    }
  ],
  "timestamp": "2025-10-24 15:30:45"
}
```

El archivo se guarda en:
- **Windows:** `C:\Users\[Usuario]\AppData\LocalLow\[CompanyName]\[GameName]\gamesave.json`
- **Mac:** `~/Library/Application Support/[CompanyName]/[GameName]/gamesave.json`

---

## üí° Pr√≥ximos Pasos

Una vez funcione todo:
1. A√±adir m√°s elementos serializables (puntuaci√≥n, items, etc.)
2. Implementar sincronizaci√≥n de animaciones
3. A√±adir efectos visuales para indicar jugador local vs remoto
4. Sistema de respawn cuando un jugador cae
5. Sincronizar estado del nivel (puertas, botones, etc.)

---

¬°Buena suerte con tu proyecto! üöÄ


Problema identificado:
Los dos jugadores se conectaban al servidor, pero cada uno cargaba su propia escena sin saber del otro jugador. Era como si jugaran en "mundos paralelos".
Soluci√≥n implementada:

GameManager - Instancia AMBOS personajes en cada cliente, pero solo uno tiene control
NetworkPlayer - Env√≠a la posici√≥n del jugador local y recibe la del remoto
IDs de jugador - El servidor asigna Player1 y Player2 autom√°ticamente
Sincronizaci√≥n en tiempo real - Las posiciones se env√≠an 20 veces por segundo
Sistema de guardado JSON - Guarda/carga posiciones y velocidades

C√≥mo funciona:
Cliente 1 (Player1)          Servidor          Cliente 2 (Player2)
      |                          |                        |
      |--- USERNAME:Player1 ---->|                        |
      |                          |<---- USERNAME:Player2 ---|
      |<--- GAME_START:1 --------|                        |
      |                          |------ GAME_START:2 ---->|
      |                          |                        |
   [Carga GameScene]         [Reenv√≠a]             [Carga GameScene]
   [Instancia P1+P2]         posiciones            [Instancia P1+P2]
   [Controla P1]             <-------->            [Controla P2]
   [Ve a P2 moverse]                               [Ve a P1 moverse]
